!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="./dist/",t(t.s=1)}([function(e,n,t){},function(e,n,t){"use strict";t.r(n);t(0);var o=8088;const r=0,c=1,i=2,l=3,s=4,a=5,u="абвгдежзиклмнопрст",d={0:{len:3,count:1},1:{len:2,count:2},2:{len:1,count:3}};function f(e){return e===r||e>=s?0:1}function m(e,n){return p(e,n,()=>{})}function g(e,n,t){if(!e[t])return s;const o=m(e,t),r=m(n,t);if(r===o)return function(e,n,t){if(e.length!==n.length)throw"Illegal state";for(let o=0;o<e.length;++o)if(o!==t&&e[o]!==f(n[o]))return!1;return!0}(e,n,t)?l:i;if(r<o)return c;throw"Illegal state"}function h(e,n,t,o){let c=n+t,i=0;for(;c<e.length&&c>=0;){if(!f(e[c])){e[c]===r&&o(c);break}c+=t,++i}return i}function p(e,n,t){let o=1;return o+=h(e,n,1,t),o+=h(e,n,-1,t),o}function v(e){return Math.floor((e.offsetX+1)/20)}function y(e,n){n(v(e))}function E(e){return document.querySelector(e)}function w(e){const n=E("#field-template").content.cloneNode(!0),t=n.firstElementChild,o=t.querySelector(".frame-text");for(const e of u){const n=document.createElement("span");n.textContent=e,o.appendChild(n)}return e.appendChild(n).firstElementChild,t}function S(e){return new Promise((function(n,t){let o=null,r=0;const c=new Array(u.length).fill(0);const i=[],l=e.querySelector(".grid"),s=w(l);s.classList.add("adjust-first");const a=function(e,n){const t=e.createElement("div");return t.classList.add("shipyard"),n.appendChild(t),t}(e,l);function f(n){i.push(function(n){const t=e.createElement("div");return t.classList.add("ship"),t.style.width=20*n+"px",a.appendChild(t),{length:n,html:t}}(n)),++r}for(let[e,n]of Object.entries(d))for(let e=0;e<n.count;e++)f(n.len);function m(e,n){o={s:e,n:n};for(const e of i)e.html.classList.remove("choosen");e.html.classList.add("choosen")}for(const e of i)e.html.addEventListener("click",n=>{const t=v(n);m(e,t)});const g=s.querySelector(".river");function h(t){const i=t-o.n;if(!function(e,n,t){if(!function(e,n,t){if(n<0)return!1;const o=n-1;if(o>=0&&e[o]>0)return!1;for(let o=0;o<t;o++){const t=n+o;if(t>e.length-1)return!1;if(e[t]>0)return!1}const r=n+t;return!(r<e.length&&e[r]>0)}(e,n,t))return!1;for(let o=0;o<t;o++)e[n+o]=1;return--r,!0}(c,i,o.s.length))return;const l=e.createElement("div");l.classList.add("ship_river"),l.classList.add("diagonal-line"),l.style.width=o.s.html.style.width,l.style.left=20*i+"px",g.appendChild(l),o.s.html.classList.add("disabled"),o=null,0===r&&(s.classList.remove("adjust-first"),s.classList.add("adjust-third"),g.removeEventListener("click",p),n(c))}function p(e){null!=o&&y(e,h)}g.addEventListener("click",p)}))}function b(){}function M(e,n,t,o,a){console.log("game begin!");const u={playerMove:b,enemyMove:b,aiMove:b};function d(e){return u.aiMove(e)}let f="blue"!==a;const m=function(e){const n=w(e);return n.classList.add("adjust-second"),n.querySelector(".river")}(e.querySelector(".grid")),h=e.querySelector(".river"),v={realField:t,guessedField:new Array(t.length).fill(r),htmlRiver:h,onOpponentMiss:b,onOpponentHit:d,isEnemy:!1},S={realField:o,guessedField:new Array(t.length).fill(r),htmlRiver:m,onOpponentMiss:d,onOpponentHit:b,isEnemy:!0};let M=null;function L(n){const t=f?v:S,o=function(e,n,t,o,r){let c=t[e];o[e]=c;const i=g(t,o,e);let l;o[e]=i,l=E(c?"#ship-template":"#dot-template2");const s=l.content.cloneNode(!0),a=s.firstElementChild;return c?n?a.classList.add("diagonal-line-enemy"):a.classList.add("diagonal-line"):n&&a.classList.add("enemy"),r.appendChild(s),a.style.left=20*e+"px",a.style.width="20px",{html:a,res:c,verdict:i}}(n,f,t.realField,t.guessedField,t.htmlRiver);var r;!function(n,t,o){let r=0;const c=e.querySelector(".message");o?c.classList.add("enemy"):c.classList.remove("enemy"),M&&(c.innerHTML="",clearInterval(M)),M=setInterval((function(){c.innerHTML+=n.charAt(r),r++,r>n.length&&(clearInterval(M),M=setTimeout(()=>{c.innerHTML=""},2e3))}),t)}(((r=o.verdict)===c?"Ранил":r===i?"Убил":r===s?"Мимо":r===l?"Победа":void 0)+"!",70,f),o.verdict===s?(f=!f,t.onOpponentMiss(o.verdict)):o.verdict===l?f?setTimeout(()=>{alert("Ты проиграл")},700):setTimeout(()=>{alert("Победа")},700):(t.onOpponentHit(o.verdict),o.verdict===i&&p(t.guessedField,n,e=>{!function(e,n,t){const o=E("#dot-template").content.cloneNode(!0),r=o.firstElementChild;t&&r.classList.add("enemy"),n.appendChild(o),r.style.left=20*e+"px",r.style.width="20px"}(e,t.htmlRiver,f)}))}function O(e){f&&(L(e),u.enemyMove(e))}function C(e){f||(L(e),u.playerMove(e))}return m.addEventListener("click",(function(e){f||y(e,C)})),{fireEnemy:O,firePlayer:C,on:function(e,n){u[e]=n}}}function L(e){return function(e,n){let t=e+Math.random()*(n-e);return Math.floor(t)}(0,e)}function O(e){let n=function(e){let n=0;for(let t=0;t<e.length;t++)e[t]===r&&++n;return L(n)}(e),t=0;for(;t<e.length&&(e[t]===r&&--n,!(n<0));t++);return(t>=e.length||t<0)&&console.table("Error out",t,e),t}function C(e){const n=[[0,1,0,0,0,1,0,1,1,0,1,0,1,1,0,1,1,1],[0,1,0,0,1,0,1,0,1,1,0,1,1,0,1,1,1,0],[0,0,0,1,0,1,0,1,0,1,1,1,0,1,1,0,1,1],[1,0,1,0,0,0,1,0,0,1,1,0,1,1,1,0,1,1],[1,0,1,0,0,0,1,1,1,0,1,1,0,1,1,0,0,1],[1,1,1,0,1,1,0,1,1,0,1,0,1,0,0,0,0,1]];return e<0&&(e=L(n.length)),n[e]}function R(e,n){const t=C(n),o=new Array(e).fill(r);let l=-1,u=0;function d(e,n){if(l<0)return O(e);if(e[l]=n,n===c){u=function(){let e=L(2);return 0===e?-1:e}();let t=-1;return h(e,l,u,e=>{t=e}),t>=0?t:(u*=-1,h(e,l,u,e=>{t=e}),t>=0?t:(console.table("Err1",n,u,l,e),O(e)))}if(n===i)return p(e,l,n=>{e[n]=a}),u=0,O(e);if(n===s){if(0!==u){u*=-1;let t=-1;return h(e,l,u,e=>{t=e}),t>=0?t:(console.table("Err",n,u,l,e),O(e))}return O(e)}return 1}return{getFieldEnemy:function(){return t},guess:function(e){return l=d(o,e),l}}}let T=null,D="",F="";const N=["blue","red"];const k={recv:function(e){console.log("Stub "+e)}};let P=null,j=!1;function x(e){const n=new RTCPeerConnection;return n.onicecandidate=function(t){n&&t&&t.candidate&&A("candidate",t.candidate,e)},P=n.createDataChannel("datachannel",{reliable:!1}),P.onopen=function(){console.log("------ DATACHANNEL OPENED ------"),j=!0},P.onclose=function(){console.log("------ DC closed! ------"),j=!1},P.onerror=function(){console.log("DC ERROR!!!")},n.ondatachannel=function(e){console.log("peerConnection.ondatachannel event fired."),e.channel.onopen=function(){console.log("Data channel is open and ready to be used.")},e.channel.onmessage=function(e){console.log("DC from ["+F+"]:"+e.data),k.recv(e.data)}},n}function A(e,n,t){const o={from:D,to:F,action:e,data:n};t.send(JSON.stringify(o)),console.log("Sending ["+D+"] to ["+F+"]: "+JSON.stringify(n))}var W={connect:function(e,n,t){T=new WebSocket("ws://"+e+":"+n);let o=null;T.onopen=function(e){console.log("Websocket opened"),D=t,F=function(e){for(const n of N)if(e!==n)return n;return""}(t),"blue"===D&&(o=function(){const e=x(T);return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1}).then((function(n){e.setLocalDescription(n),A("offer",n,T),console.log("------ SEND OFFER ------")}),(function(e){console.log(e)})),e}())},T.onclose=function(e){console.log("Websocket closed")},T.onmessage=function(e){console.log("Websocket message received: "+e.data);var n=JSON.parse(e.data);"candidate"===n.action?n.to===D&&function(e,n){console.log("------ PROCESSED ISE ------",e),n.addIceCandidate(new RTCIceCandidate(e)).catch(e=>{console.log(e)})}(n.data,o):"offer"===n.action?n.to===D&&(F=n.from,o=function(e){const n=x(T);n.setRemoteDescription(new RTCSessionDescription(e)).catch(e=>{console.log(e)});return n.createAnswer({mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}}).then((function(e){return n.setLocalDescription(e).then((function(){A("answer",e,T),console.log("------ SEND ANSWER ------")}))}),(function(e){console.log(e)})),console.log("------ PROCESSED OFFER ------"),n}(n.data)):"answer"===n.action&&n.to===D&&function(e,n){n.setRemoteDescription(new RTCSessionDescription(e)),console.log("------ PROCESSED ANSWER ------")}(n.data,o)},T.onerror=function(e){console.log("Websocket error")}},sendMessage:function(e){return!!P&&(j?(P.send(e),j):(console.log("Not connected"),!1))},on:function(e,n){k[e]=n},connectedStatus:function(){return j}};function q(e,n){const t={method:n};return t[n]=e,JSON.stringify(t)}var I={parser:function(e,n,t){const o=JSON.parse(e),r=o[o.method];return o.method===n&&t(r),r},toMove:function(e){return q(e,"move")},toField:function(e){return q(e,"field")}};function H(e){const n=R(e.length,-1),t=M(document,window,e,n.getFieldEnemy(),"blue");t.on("aiMove",(function(e){const o=n.guess(e);console.log("ai move "+o),setTimeout(()=>{t.fireEnemy(o)},700)}))}!function(e){switch(e){case"ai":S(document).then(H);break;case"fake":!function(){const e=R(C(1).length,1),n=window.location.hostname,t=window.location.search,r=new URLSearchParams(t).get("color")||"blue",c=M(document,window,C(1),e.getFieldEnemy(),r);console.log(n),W.connect(n,o,r),c.on("aiMove",(function(n){const t=e.guess(n);console.log("ai move "+t)})),W.on("recv",e=>{console.log("recieved",e),I.parser(e,"move",e=>{c.fireEnemy(e)})}),c.on("playerMove",e=>W.sendMessage(I.toMove(e)))}();break;case"net":!function(){const e=window.location.hostname,n=window.location.search,t=new URLSearchParams(n),r=!t.get("color"),c=t.get("color")||"blue";let i=!1;W.connect(e,o,c);const l=S(document);let s,a=null;const u=new Promise((function(e,n){s=e}));W.on("recv",e=>{I.parser(e,"field",e=>{console.log("enemy field ready"),i=!0,s(e)}),I.parser(e,"move",e=>{console.log("Enemy try to move "+e),a.fireEnemy(e)})}),l.then(e=>{const n=W.sendMessage(I.toField(e));if(r&&!i||!n){const n=R(e.length,-1);a=M(document,window,e,n.getFieldEnemy(),c),a.on("aiMove",(function(e){const t=n.guess(e);setTimeout(()=>{a.fireEnemy(t)},700)}))}else u.then(n=>{a=M(document,window,e,n,c),a.on("playerMove",e=>W.sendMessage(I.toMove(e)))})})}()}}("net"),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js",{scope:"./"})}]);