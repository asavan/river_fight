!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="./dist/",t(t.s=1)}([function(e,n,t){},function(e,n,t){"use strict";t.r(n);t(0);var o=8088,r=3;const c=0,i=1,l=2,s=3,u=4,a=5,d="абвгдежзиклмнопрст",f={0:{len:3,count:1},1:{len:2,count:2},2:{len:1,count:3}};function m(e){return e===c||e>=u?0:1}function g(e,n){return v(e,n,()=>{})}function h(e,n,t){if(!e[t])return u;const o=g(e,t),r=g(n,t);if(r===o)return function(e,n,t){if(e.length!==n.length)throw"Illegal state";for(let o=0;o<e.length;++o)if(o!==t&&e[o]!==m(n[o]))return!1;return!0}(e,n,t)?s:l;if(r<o)return i;throw"Illegal state"}function p(e,n,t,o){let r=n+t,i=0;for(;r<e.length&&r>=0;){if(!m(e[r])){e[r]===c&&o(r);break}r+=t,++i}return i}function v(e,n,t){let o=1;return o+=p(e,n,1,t),o+=p(e,n,-1,t),o}function y(e){return Math.floor((e.offsetX+1)/20)}function E(e,n){n(y(e))}function w(e){return document.querySelector(e)}function S(e){const n=w("#field-template").content.cloneNode(!0),t=n.firstElementChild,o=t.querySelector(".frame-text");for(const e of d){const n=document.createElement("span");n.textContent=e,o.appendChild(n)}return e.appendChild(n).firstElementChild,t}function b(e){return new Promise((function(n,t){let o=null,r=0;const c=new Array(d.length).fill(0);const i=[],l=e.querySelector(".grid"),s=S(l);s.classList.add("adjust-first");const u=function(e,n){const t=e.createElement("div");return t.classList.add("shipyard"),n.appendChild(t),t}(e,l);function a(n){i.push(function(n){const t=e.createElement("div");return t.classList.add("ship"),t.style.width=20*n+"px",u.appendChild(t),{length:n,html:t}}(n)),++r}for(let[e,n]of Object.entries(f))for(let e=0;e<n.count;e++)a(n.len);function m(e,n){o={s:e,n:n};for(const e of i)e.html.classList.remove("choosen");e.html.classList.add("choosen")}for(const e of i)e.html.addEventListener("click",n=>{const t=y(n);m(e,t)});const g=s.querySelector(".river");function h(t){const i=t-o.n;if(!function(e,n,t){if(!function(e,n,t){if(n<0)return!1;const o=n-1;if(o>=0&&e[o]>0)return!1;for(let o=0;o<t;o++){const t=n+o;if(t>e.length-1)return!1;if(e[t]>0)return!1}const r=n+t;return!(r<e.length&&e[r]>0)}(e,n,t))return!1;for(let o=0;o<t;o++)e[n+o]=1;return--r,!0}(c,i,o.s.length))return;const l=e.createElement("div");l.classList.add("ship_river"),l.classList.add("diagonal-line"),l.style.width=o.s.html.style.width,l.style.left=20*i+"px",g.appendChild(l),o.s.html.classList.add("disabled"),o=null,0===r&&(s.classList.remove("adjust-first"),s.classList.add("adjust-third"),g.removeEventListener("click",p),n(c))}function p(e){null!=o&&E(e,h)}g.addEventListener("click",p)}))}function M(){}function L(e,n,t,o,r){console.log("game begin!");const a={playerMove:M,enemyMove:M,aiMove:M};function d(e){return a.aiMove(e)}let f="blue"!==r;const m=function(e){const n=S(e);return n.classList.add("adjust-second"),n.querySelector(".river")}(e.querySelector(".grid")),g=e.querySelector(".river"),p={realField:t,guessedField:new Array(t.length).fill(c),htmlRiver:g,onOpponentMiss:M,onOpponentHit:d,isEnemy:!1},y={realField:o,guessedField:new Array(t.length).fill(c),htmlRiver:m,onOpponentMiss:d,onOpponentHit:M,isEnemy:!0};let b=null;function L(n){const t=f?p:y,o=function(e,n,t,o,r){let c=t[e];o[e]=c;const i=h(t,o,e);let l;o[e]=i,l=w(c?"#ship-template":"#dot-template2");const s=l.content.cloneNode(!0),u=s.firstElementChild;return c?n?u.classList.add("diagonal-line-enemy"):u.classList.add("diagonal-line"):n&&u.classList.add("enemy"),r.appendChild(s),u.style.left=20*e+"px",u.style.width="20px",{html:u,res:c,verdict:i}}(n,f,t.realField,t.guessedField,t.htmlRiver);var r;!function(n,t,o){let r=0;const c=e.querySelector(".message");o?c.classList.add("enemy"):c.classList.remove("enemy"),b&&(c.innerHTML="",clearInterval(b)),b=setInterval((function(){c.innerHTML+=n.charAt(r),r++,r>n.length&&(clearInterval(b),b=setTimeout(()=>{c.innerHTML=""},2e3))}),t)}(((r=o.verdict)===i?"Ранил":r===l?"Убил":r===u?"Мимо":r===s?"Победа":void 0)+"!",70,f),o.verdict===u?(f=!f,t.onOpponentMiss(o.verdict)):o.verdict===s?f?setTimeout(()=>{alert("Ты проиграл")},700):setTimeout(()=>{alert("Победа")},700):(t.onOpponentHit(o.verdict),o.verdict===l&&v(t.guessedField,n,e=>{!function(e,n,t){const o=w("#dot-template").content.cloneNode(!0),r=o.firstElementChild;t&&r.classList.add("enemy"),n.appendChild(o),r.style.left=20*e+"px",r.style.width="20px"}(e,t.htmlRiver,f)}))}function O(e){f&&(L(e),a.enemyMove(e))}function C(e){f||(L(e),a.playerMove(e))}return m.addEventListener("click",(function(e){f||E(e,C)})),{fireEnemy:O,firePlayer:C,on:function(e,n){a[e]=n}}}function O(e){return function(e,n){let t=e+Math.random()*(n-e);return Math.floor(t)}(0,e)}function C(e){let n=function(e){let n=0;for(let t=0;t<e.length;t++)e[t]===c&&++n;return O(n)}(e),t=0;for(;t<e.length&&(e[t]===c&&--n,!(n<0));t++);return(t>=e.length||t<0)&&console.table("Error out",t,e),t}function R(e){const n=[[0,1,0,0,0,1,0,1,1,0,1,0,1,1,0,1,1,1],[0,1,0,0,1,0,1,0,1,1,0,1,1,0,1,1,1,0],[0,0,0,1,0,1,0,1,0,1,1,1,0,1,1,0,1,1],[1,0,1,0,0,0,1,0,0,1,1,0,1,1,1,0,1,1],[1,0,1,0,0,0,1,1,1,0,1,1,0,1,1,0,0,1],[1,1,1,0,1,1,0,1,1,0,1,0,1,0,0,0,0,1]];return e<0&&(e=O(n.length)),n[e]}function D(e,n){const t=R(n),o=new Array(e).fill(c);let r=-1,s=0;function d(e,n){if(r<0)return C(e);if(e[r]=n,n===i){s=function(){let e=O(2);return 0===e?-1:e}();let t=-1;return p(e,r,s,e=>{t=e}),t>=0?t:(s*=-1,p(e,r,s,e=>{t=e}),t>=0?t:(console.table("Err1",n,s,r,e),C(e)))}if(n===l)return v(e,r,n=>{e[n]=a}),s=0,C(e);if(n===u){if(0!==s){s*=-1;let t=-1;return p(e,r,s,e=>{t=e}),t>=0?t:(console.table("Err",n,s,r,e),C(e))}return C(e)}return 1}return{getFieldEnemy:function(){return t},guess:function(e){return r=d(o,e),r}}}let F=null,T="",N="";const k=["blue","red"];const P={recv:function(e){console.log("Stub "+e)}};let j=null,x=!1;function A(e){const n=new RTCPeerConnection;return n.onicecandidate=function(t){n&&t&&t.candidate&&W("candidate",t.candidate,e)},j=n.createDataChannel("my channel",{negotiated:!0,id:r}),j.onmessage=function(e){console.log("DC from ["+N+"]:"+e.data),P.recv(e.data),console.log("received: "+e.data)},j.onopen=function(){console.log("------ DATACHANNEL OPENED ------"),x=!0},j.onclose=function(){console.log("------ DC closed! ------"),x=!1},j.onerror=function(){console.log("DC ERROR!!!")},n}function W(e,n,t){const o={from:T,to:N,action:e,data:n};return console.log("Sending ["+T+"] to ["+N+"]: "+JSON.stringify(n)),t.send(JSON.stringify(o))}var q={connect:function(e,n,t){F=new WebSocket("ws://"+e+":"+n);let o=null;F.onopen=function(e){console.log("Websocket opened"),T=t,N=function(e){for(const n of k)if(e!==n)return n;return""}(t),"blue"===T&&(o=function(){const e=A(F);return e.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1}).then(n=>e.setLocalDescription(n)).then(()=>{console.log("------ SEND OFFER ------"),W("offer",e.localDescription,F)}).catch(e=>console.log(e)),e}())},F.onclose=function(e){console.log("Websocket closed")},F.onmessage=function(e){const n=JSON.parse(e.data);n.to===T&&(console.log("Websocket message received: "+e.data),"candidate"===n.action?function(e,n){console.log("------ PROCESSED ISE ------",e),n.addIceCandidate(new RTCIceCandidate(e)).catch(e=>{console.log(e)})}(n.data,o):"offer"===n.action?(N=n.from,o=function(e){const n=A(F);return console.log("------ PROCESSED OFFER ------"),n.setRemoteDescription(e).then(()=>n.createAnswer()).then(e=>n.setLocalDescription(e)).then(()=>(console.log("------ TRY SEND ANSWER ------"),W("answer",n.localDescription,F))).catch(e=>console.log(e)),n}(n.data)):"answer"===n.action&&function(e,n){console.log("------ PROCESSED ANSWER ------"),n.setRemoteDescription(new RTCSessionDescription(e))}(n.data,o))},F.onerror=function(e){console.log("Websocket error")}},sendMessage:function(e){return!!j&&(x?(j.send(e),x):(console.log("Not connected"),!1))},on:function(e,n){P[e]=n},connectedStatus:function(){return x}};function I(e,n){const t={method:n};return t[n]=e,JSON.stringify(t)}var H={parser:function(e,n,t){const o=JSON.parse(e),r=o[o.method];return o.method===n&&t(r),r},toMove:function(e){return I(e,"move")},toField:function(e){return I(e,"field")}};function _(e){const n=D(e.length,-1),t=L(document,window,e,n.getFieldEnemy(),"blue");t.on("aiMove",(function(e){const o=n.guess(e);console.log("ai move "+o),setTimeout(()=>{t.fireEnemy(o)},700)}))}function J(){const e=window.location.hostname,n=window.location.search,t=new URLSearchParams(n),r=!t.get("color"),c=t.get("color")||"blue";let i=!1;try{q.connect(e,o,c)}catch(e){console.log(e)}const l=b(document);let s=null;const u=function(){let e,n;const t=new Promise((t,o)=>{e=t,n=o});return t.resolve=e,t.reject=n,t}();q.on("recv",e=>{H.parser(e,"field",e=>{console.log("enemy field ready"),i=!0,u.resolve(e)}),H.parser(e,"move",e=>{console.log("Enemy try to move "+e),s.fireEnemy(e)})}),l.then(e=>{const n=q.sendMessage(H.toField(e));if(r&&!i||!n){const n=D(e.length,-1);s=L(document,window,e,n.getFieldEnemy(),c),s.on("aiMove",(function(e){const t=n.guess(e);setTimeout(()=>{s.fireEnemy(t)},700)}))}else u.then(n=>{s=L(document,window,e,n,c),s.on("playerMove",e=>q.sendMessage(H.toMove(e)))})})}!function(e){switch(e){case"ai":b(document).then(_);break;case"fake":!function(){const e=D(R(1).length,1),n=window.location.hostname,t=window.location.search,r=new URLSearchParams(t).get("color")||"blue",c=L(document,window,R(1),e.getFieldEnemy(),r);console.log(n),q.connect(n,o,r),c.on("aiMove",(function(n){const t=e.guess(n);console.log("ai move "+t)})),q.on("recv",e=>{console.log("recieved",e),H.parser(e,"move",e=>{c.fireEnemy(e)})}),c.on("playerMove",e=>q.sendMessage(H.toMove(e)))}();break;case"net":J()}}("net"),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js",{scope:"./"})}]);